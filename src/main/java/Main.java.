import database.DatabaseConfig;
import model.Student;
import model.Inventory;
import service.StudentService;
import service.InventoryService;
import java.sql.Connection;
import java.sql.SQLException;

public class Main {
    public static void main(String[] args) {
        StudentService studentService = new StudentService();
        InventoryService inventoryService = new InventoryService();
        Connection conn = null;

        try {
            conn = DatabaseConfig.getConnection();
            // 1. Start Transaction
            DatabaseConfig.startTransaction(conn);
            System.out.println("--- Starting Level 2 Transactional Test ---");

            // 2. Perform Operations
            studentService.registerStudent(new Student("Bob Builder", "bob@example.com", "Civil Engineering"));
            inventoryService.addItem(new Inventory(50, "Tool Kit", 5));

            // 3. Commit if everything is successful
            DatabaseConfig.commitTransaction(conn);
            System.out.println("✅ Transaction Success: All data saved securely!");

        } catch (SQLException e) {
            // 4. Rollback if ANY part fails
            try {
                if (conn != null) {
                    DatabaseConfig.rollbackTransaction(conn);
                    System.err.println("❌ Transaction Failed. All changes were rolled back.");
                }
            } catch (SQLException ex) {
                ex.printStackTrace();
            }
            System.err.println("Error details: " + e.getMessage());
        }
    }
}
